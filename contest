<style>


    .contest_description{
        margin-bottom:35px;
    }
    .contest_form_div{
        margin-top:20px;
        width:75%;
        margin-left:80px;
    }
    
    .large_field{
        display:inline-block;
        width:49%;
    }
    .small_field {
        width:32.5%;
        display:inline-block;
    }
    
    .full_field input, .large_field input, .small_field input {
        width:98%;
    }
    
    @media (max-width: 767px) {
        .main{
            width:95%;
        }
        .large_field, .small_field {
            width:100%;
        }
        .contest_form_div{
            width:100%;
            margin-left:0;
        }
    }
</style>

<div id="loading_screen">
    <img alt="loading" src="//kodekloud.s3.amazonaws.com/sites/5447ebb66e6f641987020000/3604f5c26997bea3de504de139debcec/loading.gif"/>
</div>
<div  id="main_content" style="display:none">
    <nav>
        <ul class="breadcrumb">
            <li><a href="/home">Home</a> </li>
        </ul>
    </nav>
    <div class="page_banner">
        <h2>Enter To Win a $50 Gift Card!</h2>
    </div>
    <div class="inside_page_content">
        <img class="contest_image" alt="{{name}}" src="//kodekloud.s3.amazonaws.com/sites/54f605386e6f6412de000000/7867478e9350674c3101957d158063ed/MM  Contests - phone girls.png" />
     <br>
     <div class="contest_form_div">
           <p class="contest_description">Join our mailing list to be automatically entered into our monthly draw for a $50.00 gift card to the Milton Mall store of your choice. Draws will take place on the 1st of every month and winners will be notified by email by the 5th of the month.</p>

         <form action="//mobilefringe.createsend.com/t/d/s/iljuih/" method="post" id="contest_form">
            <p style="display:none">
                <label for="fieldName">Name</label><br />
                <input id="fieldName" name="cm-name" type="text"/>
            </p>
            
            <p class="large_field">
                <label for="firstName">First Name*</label><br/>
                <input id="firstName" type="text" required placeholder="First Name" />
            </p>
            <p class="large_field">
                <label for="lastName">Last Name*</label><br/>
                <input id="lastName" type="text" required placeholder="Last Name"/>
            </p>
          
            <p class="large_field">
                <label for="fieldEmail">Email*</label><br />
                <input id="fieldEmail" name="cm-iljuih-iljuih" type="email" required placeholder="Email"/>
            </p>
            <p class="large_field">
                <label for="fieldjykyhy">Phone Number*</label><br />
                <input id="fieldjykyhy" name="cm-f-jykyhy" type="text" required placeholder="Phone Number"/>
            </p>
            <p class="full_field">
                <label for="fieldjykyhh">Street Address</label><br />
                <input id="fieldjykyhh" name="cm-f-jykyhh" type="text" placeholder="Street Address"/>
            </p>
            <p class="small_field">
                <label for="fieldjykyhd">City</label><br />
                <input id="fieldjykyhd" name="cm-f-jykyhd" type="text" placeholder="City"/>
            </p>
            
            <p class="small_field">
                <label for="fieldjykyhj">Postal Code*</label><br />
                <input id="fieldjykyhj" name="cm-f-jykyhj" type="text" required placeholder="Postal Code"/>
            </p>
            <p class="small_field">
                <label for="fieldjykyht">Year of Birth*</label><br />
                <input id="fieldjykyht" name="cm-f-jykyht" type="text" required placeholder= "Year of Birth"/>
            </p>
            <p style="display:none">
                <label for="fieldjykyhi">Contest ID</label><br />
                <input id="fieldjykyhi" name="cm-f-jykyhi" type="text" />
            </p>
            <br>
            <br>
            
       
            <br>
                <label for="enterVerify">Enter the following number below to proceed: <div id="verifyNum"></div></label><br>
                <input type="hidden" value="701469" id="verifyNumHidden" name="verifyNumHidden" />
                <input type="text" id="enterVerify" name="enterVerify" />
            <br>

            <span>
                <br>
                <label for="newsletter_signup" style="display:none">Agree Terms</label>
              <input type="checkbox" class="info_check" id="newsletter_signup"/>&nbsp;Yes, I would like to receive ongoing news related to events, promotions and special   
  announcements from Milton Mall.
            </span>
            <br>
            <br>
            <span>
                <label for="agree_terms" style="display:none">Agree Terms</label>
              <input type="checkbox" class="info_check" id="agree_terms" required/>&nbsp;I agree to the <a href = "/rules_regulations"><u>Rules and Regulations</u></a>. 
            </span>
            <br>
            <br>
            <p>
                <button class="btn btn-primary" type="submit">Submit</button>
            </p>
        </form>
     </div>
    </div>
</div>
<script>
    function randomgen() {
        var rannumber='';
        for(ranNum=1; ranNum<=6; ranNum++){
            rannumber+=Math.floor(Math.random()*10).toString();
        }
        $('#verifyNum').html(rannumber);
        $('#verifyNumHidden').val(rannumber);
    }
    randomgen();
  
    
    $('#contest_form').submit(function (e) {
        if($('#enterVerify').val() == $('#verifyNumHidden').val() ) {
            if ($("#agree_terms").prop("checked") == true){
                var e = verify_required_fields();
                if (e == true){
                    var name = $("#firstName").val() + " " + $("#lastName").val();
                    $('input[name="cm-name"]').attr('value',name);
                    var date = new Date;
                    contest_id = (get_month(date.getMonth())) + date.getFullYear();
                    $('input[name="cm-f-jykyhi"]').attr('value',contest_id);
                    if ($("#newsletter_signup").prop("checked") == true){
                        var s = check_email();
                        if (s == true){
                            var email = $("#fieldEmail").val();
                            $('input[name="cm-iljuii-iljuii"]').attr('value',email);
                            console.log($("#subForm").serialize())
                             $.getJSON(
                                "//mobilefringe.createsend.com/t/d/s/iljuii/?callback=?",
                               $("#subForm").serialize(),
                                function (data) {
                                    if (data.Status === 400) {
                                        e.preventDefault();
                                        alert("Please try again later.");
                                    } else { // 200
                                        // $('#contest_form').unbind('submit').submit();
                                    }
                            });  
                        } else {
                            e.preventDefault();
                            alert("Invaid E-mail address.")
                        }
                        
                    } else {
                        $('#contest_form').unbind('submit').submit();    
                    }    
                } else {
                    e.preventDefault();
                    alert("One or more required fields are blank! please fill in all fields marked with * and try again.")
                }
                
                
            } else {
                e.preventDefault();
                alert("Please agree to the terms and conditions before submitting!")
            }
        }
            else
            {
                alert("Please Enter Correct Verification Number");
                randomgen();
                e.preventDefault();
            }
        
    });
    
    
    function verify_required_fields (){
        if ($("#firstName").val() != "" && $("#lastName").val() != "" && $("#fieldEmail").val() != "" && $("#fieldjrihe").val() != "" && $("#fieldjrihs").val() != "" && $("#fieldjrihg").val() != "") {
            return true;
        } else {
            return false;
        }
    }
    
    function check_email (){
        var email = $("#fieldEmail").val();
        if( !validateEmail(email)) {
            return false
        } else {
            return true
        }
    }
    
    function validateEmail($email) {
      var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
      if( !emailReg.test( $email ) ) {
        return false;
      } else {
        return true;
      }
    }
    
    function get_month (id){
        switch(id) {
            case 0:
                month = "Jan"
                break;
            case 1:
                month = "Feb"
                break;
            case 2:
                month = "Mar"
                break;
            case 3:
                month = "Apr"
                break;
            case 4:
                month = "May"
                break;
            case 5:
                month = "June"
                break;
            case 6:
                month = "July"
                break;
            case 7:
                month = "Aug"
                break;
            case 8:
                month = "Sep"
                break;
            case 9:
                month = "Oct"
                break;
            case 10:
                month = "Nov"
                break;
            case 11:
                month = "Dec"
                break;
                
        }
        return month;
    }

    $(document).ready(function() {
        function renderAll (){
            var propertyDetails = getPropertyDetails();
            renderPageData('#centre_info_container','#centre_info_template',propertyDetails, 'property_details')
            $("#loading_screen").hide();
            $("#main_content").show();
        }
        
    
        function renderPageData(container, template, collection, type){
            var item_list = [];
            var item_rendered = [];
            var template_html = $(template).html();
            Mustache.parse(template_html);   // optional, speeds up future uses
            if (type == "property_details"){
                item_list.push(collection);
                collection = []
                collection = item_list;
            }
            $.each( collection , function( key, val ) {
                var rendered = Mustache.render(template_html,val);
                item_rendered.push(rendered);
    
            });
            
            $(container).show();
            $(container).html(item_rendered.join(''));
        };

        loadMallData(renderAll);  

    
  
    });
    
</script>